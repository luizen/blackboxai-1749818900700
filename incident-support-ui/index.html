<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Incident Support Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fff;
      color: #111;
    }
    /* Scrollbar for sidebar */
    .sidebar-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .sidebar-scrollbar::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 4px;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">
  <!-- Sidebar -->
  <aside class="w-full md:w-72 bg-gray-100 border-r border-gray-300 sidebar-scrollbar overflow-y-auto max-h-screen p-4">
    <h1 class="text-2xl font-semibold mb-6 border-b border-gray-300 pb-2">Open Incidents</h1>
    <ul id="incidentList" class="space-y-3">
      <!-- Incident items inserted by JS -->
    </ul>
  </aside>

  <!-- Main content -->
  <main class="flex-1 p-6 overflow-y-auto max-h-screen">
    <div id="incidentDetails" class="space-y-8">
      <p class="text-gray-500 italic">Select an incident from the list to see details.</p>
    </div>
  </main>

  <script>
    // Sample data for incidents
    const incidents = [
      {
        id: 'INC0012345',
        title: 'Application A - Database connection failure',
        description: 'Users report intermittent database connection errors in Application A.',
        application: 'Application A',
        relatedIncidents: [
          { id: 'INC0012300', title: 'Application A - Slow response times' },
          { id: 'INC0012200', title: 'Application A - Timeout errors' }
        ],
        similarIncidents: [
          { id: 'INC0012100', title: 'Application B - Database connection failure' },
          { id: 'INC0012000', title: 'Application C - Database connection failure' }
        ],
        relatedChanges: [
          { id: 'CHG1234', description: 'Updated DB connection pool settings', date: '2024-06-01' },
          { id: 'CHG1235', description: 'Deployed new version of Application A', date: '2024-06-02' }
        ],
        expectedClassification: {
          priority: 'High',
          confidence: 87
        },
        relatedProblems: [
          { id: 'PRB1001', title: 'Database connectivity issues' }
        ],
        relatedApplications: [
          { name: 'Application B', contactName: 'John Doe', phone: '+1-555-1234' },
          { name: 'Application C', contactName: 'Jane Smith', phone: '+1-555-5678' }
        ],
        relatedIntegrations: [
          { type: 'MQ', name: 'Queue_A' },
          { type: 'API', name: 'API_Endpoint_1' }
        ],
        commitsPRs: [
          { id: 'PR#456', title: 'Fix DB connection retry logic', date: '2024-06-03' },
          { id: 'Commit#789', title: 'Improve DB connection pool', date: '2024-06-02' }
        ],
        logsLink: 'https://logs.company.com/appA',
        classificationAnalysis: {
          priorityCorrect: true,
          assignedTeamCorrect: false
        },
        artsInfo: {
          SLA: '99.9%',
          businessCriticality: 'High',
          IRT: '30 mins',
          IRR: '1 hour'
        },
        currentSupportShift: {
          name: 'Alice Johnson',
          email: 'alice.johnson@company.com',
          phone: '+1-555-9999'
        },
        itsmLink: 'https://itsm.company.com?id=INC0012345',
        productionImpact: {
          chancePercent: 75,
          impacted: true
        }
      },
      {
        id: 'INC0012346',
        title: 'Application B - API timeout errors',
        description: 'API calls to Application B are timing out intermittently.',
        application: 'Application B',
        relatedIncidents: [],
        similarIncidents: [],
        relatedChanges: [],
        expectedClassification: {
          priority: 'Medium',
          confidence: 65
        },
        relatedProblems: [],
        relatedApplications: [],
        relatedIntegrations: [],
        commitsPRs: [],
        logsLink: '',
        classificationAnalysis: {
          priorityCorrect: true,
          assignedTeamCorrect: true
        },
        artsInfo: {
          SLA: '99.5%',
          businessCriticality: 'Medium',
          IRT: '1 hour',
          IRR: '2 hours'
        },
        currentSupportShift: {
          name: 'Bob Williams',
          email: 'bob.williams@company.com',
          phone: '+1-555-8888'
        },
        itsmLink: 'https://itsm.company.com?id=INC0012346',
        productionImpact: {
          chancePercent: 20,
          impacted: false
        }
      }
    ];

    // Utility to create an element with classes and text
    function createEl(tag, classes = '', text = '') {
      const el = document.createElement(tag);
      if (classes) el.className = classes;
      if (text) el.textContent = text;
      return el;
    }

    // Render incident list in sidebar
    function renderIncidentList() {
      const list = document.getElementById('incidentList');
      list.innerHTML = '';
      incidents.forEach((incident, index) => {
        const li = createEl('li', 'cursor-pointer p-3 rounded hover:bg-gray-200 transition-colors flex items-center space-x-3');
        li.setAttribute('data-index', index);
        li.tabIndex = 0;
        li.setAttribute('role', 'button');
        li.setAttribute('aria-pressed', 'false');

        const icon = createEl('i', 'fas fa-exclamation-circle text-red-600');
        li.appendChild(icon);

        const title = createEl('span', 'font-semibold text-gray-900');
        title.textContent = incident.title;
        li.appendChild(title);

        li.addEventListener('click', () => {
          selectIncident(index);
        });
        li.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectIncident(index);
          }
        });

        list.appendChild(li);
      });
    }

    // Render details of selected incident
    function renderIncidentDetails(incident) {
      const container = document.getElementById('incidentDetails');
      container.innerHTML = '';

      // Header with title and incident ID
      const header = createEl('div', 'mb-4');
      const title = createEl('h2', 'text-3xl font-bold mb-1', incident.title);
      const idLink = createEl('a', 'text-blue-600 hover:underline text-sm', incident.id);
      idLink.href = incident.itsmLink;
      idLink.target = '_blank';
      idLink.rel = 'noopener noreferrer';
      header.appendChild(title);
      header.appendChild(idLink);
      container.appendChild(header);

      // Description
      const desc = createEl('p', 'mb-6 text-gray-700', incident.description);
      container.appendChild(desc);

      // Sections container
      const sections = createEl('div', 'space-y-8');

      // Related Incidents
      sections.appendChild(createSection('Related Incidents', 'fas fa-link', incident.relatedIncidents.length, () => {
        return incident.relatedIncidents.length > 0 ? createListItems(incident.relatedIncidents) : createEmptyMessage('No related incidents.');
      }));

      // Similar Incidents
      sections.appendChild(createSection('Similar Incidents', 'fas fa-clone', incident.similarIncidents.length, () => {
        return incident.similarIncidents.length > 0 ? createListItems(incident.similarIncidents) : createEmptyMessage('No similar incidents.');
      }));

      // Related Changes
      sections.appendChild(createSection('Related Changes', 'fas fa-code-branch', incident.relatedChanges.length, () => {
        if (incident.relatedChanges.length === 0) return createEmptyMessage('No related changes.');
        const ul = document.createElement('ul');
        ul.className = 'list-disc list-inside space-y-1';
        incident.relatedChanges.forEach(change => {
          const li = createEl('li');
          li.textContent = `${change.date}: ${change.description} (${change.id})`;
          ul.appendChild(li);
        });
        return ul;
      }));

      // Expected Classification
      sections.appendChild(createSection('Expected Classification', 'fas fa-chart-line', 1, () => {
        const div = createEl('div', 'space-y-1');
        const priority = createEl('p', '', `Priority: ${incident.expectedClassification.priority}`);
        const confidence = createEl('p', '', `Priority Confidence: ${incident.expectedClassification.confidence}%`);
        div.appendChild(priority);
        div.appendChild(confidence);
        return div;
      }));

      // Related Problems
      sections.appendChild(createSection('Related Problems', 'fas fa-exclamation-triangle', incident.relatedProblems.length, () => {
        return incident.relatedProblems.length > 0 ? createListItems(incident.relatedProblems) : createEmptyMessage('No related problems.');
      }));

      // Related Applications/Systems
      sections.appendChild(createSection('Related Applications/Systems', 'fas fa-network-wired', incident.relatedApplications.length, () => {
        if (incident.relatedApplications.length === 0) return createEmptyMessage('No related applications.');
        const table = createEl('table', 'w-full text-left border border-gray-300');
        const thead = createEl('thead', 'bg-gray-200');
        const trHead = createEl('tr');
        ['Application', 'Contact Name', 'Phone'].forEach(text => {
          const th = createEl('th', 'p-2 border border-gray-300 font-semibold', text);
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);
        table.appendChild(thead);
        const tbody = createEl('tbody');
        incident.relatedApplications.forEach(app => {
          const tr = createEl('tr', 'hover:bg-gray-100');
          [app.name, app.contactName, app.phone].forEach(text => {
            const td = createEl('td', 'p-2 border border-gray-300', text);
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        return table;
      }));

      // Related Integrations
      sections.appendChild(createSection('Related Integrations', 'fas fa-plug', incident.relatedIntegrations.length, () => {
        if (incident.relatedIntegrations.length === 0) return createEmptyMessage('No related integrations.');
        const ul = document.createElement('ul');
        ul.className = 'list-disc list-inside space-y-1';
        incident.relatedIntegrations.forEach(integration => {
          const li = createEl('li');
          li.textContent = `${integration.type}: ${integration.name}`;
          ul.appendChild(li);
        });
        return ul;
      }));

      // Commits and PRs
      sections.appendChild(createSection('Commits and PRs', 'fas fa-code-commit', incident.commitsPRs.length, () => {
        if (incident.commitsPRs.length === 0) return createEmptyMessage('No commits or PRs.');
        const ul = document.createElement('ul');
        ul.className = 'list-disc list-inside space-y-1';
        incident.commitsPRs.forEach(item => {
          const li = createEl('li');
          li.textContent = `${item.date}: ${item.title} (${item.id})`;
          ul.appendChild(li);
        });
        return ul;
      }));

      // Link to Application Logs
      sections.appendChild(createSection('Link to Application Logs', 'fas fa-file-alt', incident.logsLink ? 1 : 0, () => {
        if (!incident.logsLink) return createEmptyMessage('No logs link available.');
        const a = createEl('a', 'text-blue-600 hover:underline');
        a.href = incident.logsLink;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = 'View Application Logs';
        return a;
      }));

      // Classification Analysis
      sections.appendChild(createSection('Classification Analysis', 'fas fa-search', 1, () => {
        const div = createEl('div', 'space-y-1');
        const priorityCorrect = createEl('p', '', `Priority Correct: ${incident.classificationAnalysis.priorityCorrect ? 'Yes' : 'No'}`);
        const assignedTeamCorrect = createEl('p', '', `Assigned Team Correct: ${incident.classificationAnalysis.assignedTeamCorrect ? 'Yes' : 'No'}`);
        div.appendChild(priorityCorrect);
        div.appendChild(assignedTeamCorrect);
        return div;
      }));

      // ARTS Info
      sections.appendChild(createSection('ARTS (Application Runtime IT Service) Info', 'fas fa-clock', 1, () => {
        const div = createEl('div', 'space-y-1');
        const sla = createEl('p', '', `SLA: ${incident.artsInfo.SLA}`);
        const businessCriticality = createEl('p', '', `Business Criticality: ${incident.artsInfo.businessCriticality}`);
        const irt = createEl('p', '', `IRT: ${incident.artsInfo.IRT}`);
        const irr = createEl('p', '', `IRR: ${incident.artsInfo.IRR}`);
        div.appendChild(sla);
        div.appendChild(businessCriticality);
        div.appendChild(irt);
        div.appendChild(irr);
        return div;
      }));

      // Current Support Shift Person Contact
      sections.appendChild(createSection('Current Support Shift Person Contact', 'fas fa-user', 1, () => {
        const div = createEl('div', 'space-y-1');
        const name = createEl('p', '', `Name: ${incident.currentSupportShift.name}`);
        const email = createEl('p', '', `Email: ${incident.currentSupportShift.email}`);
        const phone = createEl('p', '', `Phone: ${incident.currentSupportShift.phone}`);
        div.appendChild(name);
        div.appendChild(email);
        div.appendChild(phone);
        return div;
      }));

      // Production Impact
      sections.appendChild(createSection('Production Impact', 'fas fa-industry', 1, () => {
        const div = createEl('div', 'space-y-1');
        const chance = createEl('p', '', `Chance to stop production line: ${incident.productionImpact.chancePercent}%`);
        div.appendChild(chance);
        if (incident.productionImpact.impacted) {
          const flag = createEl('p', 'text-red-700 font-semibold', '⚠️ Production line impacted!');
          div.appendChild(flag);
        }
        return div;
      }));

      container.appendChild(sections);
    }

    // Helper to create a section with icon, title, count and content callback
    function createSection(title, iconClass, count, contentCallback) {
      const section = createEl('section', 'border border-gray-300 rounded p-4 shadow-sm');
      const header = createEl('div', 'flex items-center mb-3 space-x-2');
      const icon = createEl('i', `${iconClass} text-gray-700 text-lg`);
      const titleEl = createEl('h3', 'text-xl font-semibold', title);
      const countEl = createEl('span', 'ml-auto bg-gray-200 text-gray-700 text-sm font-medium px-2 py-0.5 rounded-full select-none');
      countEl.textContent = count;
      header.appendChild(icon);
      header.appendChild(titleEl);
      header.appendChild(countEl);
      section.appendChild(header);
      section.appendChild(contentCallback());
      return section;
    }

    // Helper to create list items with links to incidents/problems
    function createListItems(items) {
      const ul = document.createElement('ul');
      ul.className = 'list-disc list-inside space-y-1';
      items.forEach(item => {
        const li = createEl('li');
        if (item.id) {
          const a = createEl('a', 'text-blue-600 hover:underline');
          a.href = `https://itsm.company.com?id=${item.id}`;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = item.title || item.id;
          li.appendChild(a);
        } else {
          li.textContent = item.title || '';
        }
        ul.appendChild(li);
      });
      return ul;
    }

    // Helper to create empty message
    function createEmptyMessage(message) {
      const p = createEl('p', 'italic text-gray-500', message);
      return p;
    }

    // Select incident and render details
    function selectIncident(index) {
      const incident = incidents[index];
      renderIncidentDetails(incident);
      // Update aria-pressed and active styles
      const listItems = document.querySelectorAll('#incidentList li');
      listItems.forEach((li, i) => {
        if (i === index) {
          li.classList.add('bg-gray-300');
          li.setAttribute('aria-pressed', 'true');
          li.focus();
        } else {
          li.classList.remove('bg-gray-300');
          li.setAttribute('aria-pressed', 'false');
        }
      });
    }

    // Initial render
    renderIncidentList();
  </script>
</body>
</html>
